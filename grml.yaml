env:
    BINDIR:    ${ROOT}/bin

commands:
    clean:
        help: clean the build files
        exec: |
            chmod -R 0750 "${BINDIR}" | true
            rm -rf "${BINDIR}"
    test:
        help: run all go tests
        exec: |
            go test -race ./pkg/... ./internal/... ./cmd/...

    generate:
        help: generate all internal msgp code
        exec: |
            go generate ./internal/...

    run:
        help: run commands
        commands:
            simple:
                help: run the simple example application.
                commands:
                    client:
                        help: run the client of the simple example application.
                        deps:
                            - build.simple
                        exec: |
                            while true
                            do
                                "${BINDIR}/simple-client"
                            done
                    server:
                        help: run the server of the simple example application.
                        deps:
                            - build.simple
                        exec: |
                            "${BINDIR}/simple-server"

    build:
        help: build commands
        commands:
            orbit:
                help: build the orbit application.
                exec: |
                    go build -o "${BINDIR}/orbit" "${ROOT}/cmd/orbit/"
            simple:
                help: build the simple example application.
                deps:
                    - build.orbit
                exec: |
                    "${BINDIR}/orbit" gen --force "${ROOT}/examples/simple/hello"
                    go build -o "${BINDIR}/simple-client" "${ROOT}/examples/simple/client"
                    go build -o "${BINDIR}/simple-server" "${ROOT}/examples/simple/server"
